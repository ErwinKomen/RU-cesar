{% extends "layout.html" %}
{% load i18n %}

{% block breadcrumbs %}
  <div class="breadcrumbs">
      <a href="{% url 'home' %}">Home</a>
      &rsaquo; <a href="{% url 'seeker_list' %}">Search</a>
      &rsaquo; Define
  </div>
{% endblock %}

{% block content %}

  <!-- Contents -->
  <div class="container body-content">
    <h2>Research project</h2>
    <div id="research_err">
      <code>
          {% for item in error_list %}
          {{item}}
          {% endfor %}
      </code>
    </div>
    <div class="xpanel xpanel-default">

      <div class="btn-group" role="group" aria-label="Research specification">
        <button type="button" class="btn btn-secondary" onclick="ru.cesar.seeker.research_wizard(this, '1');">Project type</button>
        <button type="button" class="btn btn-primary" onclick="ru.cesar.seeker.research_wizard(this, '2');">Search elements >></button>
        <button type="button" class="btn btn-primary" onclick="ru.cesar.seeker.research_wizard(this, '3');">Global >></button>
        <button type="button" class="btn btn-primary" onclick="ru.cesar.seeker.research_wizard(this, '4');">Variables >></button>
        <button type="button" class="btn btn-primary" disabled onclick="ru.cesar.seeker.research_wizard(this, '6');">Conditions >></button>
        <button type="button" class="btn btn-primary" disabled onclick="ru.cesar.seeker.research_wizard(this, '7');">Features</button>
      </div>

      <div class="panel panel-default">
        <!-- The form, divided per content element -->
        <form action="" method="post">
            {% csrf_token %}
          <!-- The hidden elements we work with -->
          <div class="hidden">
            <input name='research_part' class='form-control' value='wrd' >
            <input id="submit_type" name='submit_type' class='form-control' value='simple'>
          </div>

          <!-- Part 1: select the TYPE of the construction's main element -->
          <div id="research_part_1" class="row research-part" >
            <table>
              <tr><td>Project name:</td><td>{{form.name}}</td></tr>
              <tr><td>Purpose:</td><td>{{form.purpose}}</td></tr>
              <tr><td>Main element type:</td><td>{{form.targetType}}</td></tr>
            </table>

            <!-- GATEWAY specification is hidden -->
            <div id="research_gateway" class="hidden">
                {{form.gateway_form}}
              {{form.gateway_form.id}}
            </div>

            <div class="submit-row">
              <button type="button" class="btn btn-primary ajaxform"
                      instanceid="{{form.instance.id}}"
                      ajaxurl="{% url 'research_part_1' %}"
                      data="">{% trans 'Save' %}</button>
            </div>
          </div>

          <!-- Part 2: One or more search elements -->
          <div id="research_part_2" 
               class="row research-part hidden js-inline-formset inline-group"
               data-inline-type="tabular"
               data-inline-formset="{{construction_formset.inline_formset_data}}">

            <!-- WORD search elements -->
            <div id="research_intro-wrd" 
                 class="hidden research-wrd tabular inline-related">
                {{ construction_formset.management_form }}
                <fieldset class="module {{construction_formset.classes}}">
                <p>Provide one or more word-based search element(s)</p>
                <ul class="list-unstyled">
                  <li><span>&bull; &nbsp;</span>If a search element consists of more words, put them on one line.</li>
                  <li><span>&bull; &nbsp;</span>If a search element can be one of a set of words,
                  put those words on separate lines.</li>
                </ul>
                <table>
                  <thead><tr><th>#</th><th>Name</th><th>Word(s)</th>{% if form.instance.owner == user %}<th>DELETE?</th>{% endif %}</tr></thead>
                  <tbody>
                    {% for wrd_form in construction_formset %}
                    <tr class="form-row">
                      <td class="hidden">{{wrd_form.id}}</td>
                      <td valign="top">{{forloop.counter}}</td>
                      <td valign="top">{{wrd_form.name}}</td>
                      <td valign="top">{{wrd_form.value}}</td>
                      {% if form.instance.owner == user %}
                      <td valign="top">{{wrd_form.DELETE}}</td>
                      {% endif %}
                    </tr>
                    {% endfor %}
                    {% if form.instance.owner == user %}
                    <tr id="arguments-empty" class="form-row empty-form row1">
                        <td class="hidden">{{construction_formset.empty_form.id}}</td>
                        <td valign="top">__counter__</td>
                        <td valign="top">{{construction_formset.empty_form.name}}</td>
                        <td valign="top">{{construction_formset.empty_form.value}}</td>
                        <td valign="top" align="center">{{construction_formset.empty_form.DELETE}}</td>
                    </tr>
                    <tr class="add-row">
                      <td colspan="4">
                        <a href="#"><span class="glyphicon glyphicon-plus">&nbsp;</span>Add another search element option</a>
                      </td>
                    </tr>
                    {% endif %}
                  </tbody>
                </table>
              </fieldset>
            </div>

            <!-- CONSTITUENT search elements -->
            <div id="research_intro-cns" class="hidden research-cns">
              <p>Provide one or more options for the search construction.</p>
              <p>Each search construction starts out with one constituent, which can be further specified by e.g. children or siblings.</p>
            </div>
            <!-- Show the buttons to save, cancel, delete and so forth -->
            {% include "submit_row.html" with currentowner=form.instance.owner %}
          </div>

          <!-- Part 3: Global variables -->
          <div id="research_part_3" class="row research-part hidden">

            <!-- Global Variable specification-->
            <div class="row js-inline-formset inline-group"
                 data-inline-type="tabular"
                 data-inline-formset="{{gvar_formset.inline_formset_data}}">
                <!-- GLOBAL VARIABLE specification -->
                <div id="research_gvar" class="tabular inline-related">
                  {{gvar_formset.management_form}}
                    <fieldset class="module {{gvar_formset.classes}}">
                      <p>Provide the names and values of static, global variables (if there are any)</p>
                      <table>
                        <thead><tr><th>Name</th><th>Description</th><th>Value</th><th>DELETE?</th></tr></thead>
                        <tbody>
                          {% for gvar_this in gvar_formset %}
                          <tr class="form-row">
                            <td class="hidden">{{gvar_this.variable_ptr}}</td>
                            <td valign="top">{{gvar_this.name}}</td>
                            <td valign="top">{{gvar_this.description}}</td>
                            <td valign="top">{{gvar_this.value}}</td>
                            <td valign="top">{{gvar_this.DELETE}}</td>
                          </tr>
                          {% endfor %}
                          {% if form.instance.owner == user %}
                          <tr id="arguments-empty" class="form-row empty-form row1">
                            <td class="hidden">{{gvar_formset.empty_form.variable_ptr}}</td>
                            <td valign="top">{{gvar_formset.empty_form.name}}</td>
                            <td valign="top">{{gvar_formset.empty_form.description}}</td>
                            <td valign="top">{{gvar_formset.empty_form.value}}</td>
                            <td valign="top" align="center">{{gvar_formset.empty_form.DELETE}}</td>
                          </tr>
                          <tr class="add-row">
                            <td colspan="4">
                              <a href="#"><span class="glyphicon glyphicon-plus">&nbsp;</span>Add another global variable</a>
                            </td>
                          </tr>
                          {% endif %}
                        </tbody>
                      </table>
                    </fieldset>
                </div>

            </div>

            <!-- Show the buttons to save, cancel, delete and so forth -->
            {% include "submit_row.html" with currentowner=form.instance.owner %}
          </div>

          <!-- Part 4: Construction Variables -->
          <div id="research_part_4" class="row research-part hidden">

            <!-- Construction variable definitions -->
            <div class="row js-inline-formset inline-group"
                 data-inline-type="tabular"
                 data-inline-formset="{{vardef_formset.inline_formset_data}}">
                <!-- VARIABLE definition specification -->
                <div id="research_vardef" class="tabular inline-related">
                  {{vardef_formset.management_form}}
                    <fieldset class="module {{vardef_formset.classes}}">
                      <p>Provide the names and descriptions of the data-dependant variables</p>
                      <table>
                        <thead><tr><th>Name</th><th>Description</th><th></th><th>DELETE?</th></tr></thead>
                        <tbody>
                          {% for vardef_this in vardef_formset %}
                            <tr id="arguments-{{forloop.counter0}}" class="form-row row{{forloop.counter}}">
                              <td class="hidden">{{vardef_this.variable_ptr}}</td>
                              <td valign="top">{{vardef_this.name}}</td>
                              <td valign="top">{{vardef_this.description}}</td>
                              <td valign="top" align="left">
                                <a class="btn btn-xs btn-default cvar-calculate" role="button" loopid="research_calc_{{forloop.counter}}" >Calculation...</a>
                              </td>
                              <td valign="top" align="center">{{vardef_this.DELETE}}</td>
                            </tr>
                            {% include "seeker/part4sub.html" with vardef_number=forloop.counter %}
                          {% endfor %}
                          {% if form.instance.owner == user %}
                          <tr id="arguments-empty" class="form-row empty-form row1">
                            <td class="hidden">{{vardef_formset.empty_form.variable_ptr}}</td>
                            <td valign="top">{{vardef_formset.empty_form.name}}</td>
                            <td valign="top">{{vardef_formset.empty_form.description}}</td>
                            <td valign="top" align="left">
                              <a class="btn btn-xs btn-default cvar-calculate" role="button" loopid="research_calc___counter__" >Calculation...</a>
                            </td>
                            <td valign="top" align="center">{{vardef_formset.empty_form.DELETE}}</td>
                          </tr>
                          <tr class="add-row">
                            <td colspan="4">
                              <a href="#"><span class="glyphicon glyphicon-plus">&nbsp;</span>Add another construction variable definition</a>
                            </td>
                          </tr>
                          {% endif %}
                        </tbody>
                      </table>
                    </fieldset>
                </div>

            </div>

            <!-- Show the buttons to save, cancel, delete and so forth -->
            {% include "submit_row.html" with currentowner=form.instance.owner %}
          </div>

          <!-- Part 5: Conditions -->
          <div id="research_part_6" class="row research-part hidden">
              Specifying hit conditions
            <!-- Show the buttons to save, cancel, delete and so forth -->
            {% include "submit_row.html" with currentowner=form.instance.owner %}
          </div>

          <!-- Part 6: Features -->
          <div id="research_part_7" class="row research-part hidden">
              Feature calculation
            <!-- Show the buttons to save, cancel, delete and so forth -->
            {% include "submit_row.html" with currentowner=form.instance.owner %}
          </div>

        </form>  
        
      </div>


    </div>
  </div>

<script>
  $('tr.add-row a').click(ru.cesar.seeker.tabular_addrow);
  $('.inline-group > div > a.btn').click(function () {
    var elGroup = null,
        elTabular = null,
        sStatus = "";

    // Get the tabular
    elTabular = $(this).parent().next(".tabular");
    if (elTabular !== null) {
      // Get the status of this one
      if ($(elTabular).hasClass("hidden")) {
        $(elTabular).removeClass("hidden");
      } else {
        $(elTabular).addClass("hidden");
      }
    }
  });
  $('td span.td-toggle-textarea').click(ru.cesar.seeker.toggle_textarea_click);
  $('td span.td-textarea').mouseout(ru.cesar.seeker.toggle_textarea_out);
  ru.cesar.seeker.research_wizard(this, '1');
</script>

{% endblock content %}

{% block script %}
{% endblock %}
